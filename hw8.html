<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Caesar Cipher & Frequency Analysis</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Aggiungi il tuo stile CSS qui */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }

        body {
            background-color: #f4f4f9;
            color: #333;
            line-height: 1.6;
            font-size: 16px;
        }

        header {
            background-color: #007bff;
            color: white;
            padding: 1rem;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        header h1 {
            font-size: 2.2rem;
            margin: 0;
        }

        main {
            width: 90%;
            max-width: 1200px;
            margin: 2rem auto;
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        section {
            background-color: #fff;
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        section h2 {
            font-size: 1.75rem;
            margin-bottom: 1rem;
            color: #333;
        }

        label {
            font-weight: bold;
            display: block;
            margin-top: 1rem;
            color: #555;
        }

        textarea, input, button {
            padding: 0.75rem;
            font-size: 1rem;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-top: 0.5rem;
            width: 100%;
        }

        textarea {
            resize: vertical;
        }

        button {
            background-color: #007bff;
            color: white;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-top: 1rem;
        }

        button:hover {
            background-color: #0056b3;
        }

        button:active {
            background-color: #003f8b;
        }

        h3 {
            font-size: 1.2rem;
            margin-top: 1.5rem;
            color: #333;
        }

        p {
            font-size: 1rem;
            margin-top: 1rem;
            color: #555;
        }

        footer {
            background-color: #f1f1f1;
            padding: 1rem;
            text-align: center;
            color: #777;
            font-size: 0.9rem;
        }

        footer p {
            margin: 0;
        }

        #letterDistributionChart {
            margin-top: 2rem;
            width: 100%;
            height: 300px;
        }

    </style>
</head>
<body>
    <header>
        <h1>Caesar Cipher, Shannon Entropy and Frequency Analysis</h1>
    </header>

    <main>
        <section>
            <h2>Encrypt Text with Caesar Cipher</h2>
            <label for="inputText">Enter Text:</label>
            <textarea id="inputText" rows="4" placeholder="Type your text here..."></textarea>

            <label for="shiftValue">Shift Amount:</label>
            <input type="number" id="shiftValue" value="3" min="1" max="25">

            <button onclick="encryptText()">Encrypt</button>

            <h3>Encrypted Text:</h3>
            <p id="cryptedText">N/A</p>
        </section>

        <section>
            <h2>Letter Frequency Distribution</h2>
            <canvas id="letterDistributionChart"></canvas>
        </section>

        <section>
            <h2>Frequency Analysis Decryption</h2>
            <button onclick="decryptText()">Attempt Decryption</button>
            <h3>Decrypted Text:</h3>
            <p id="decryptedText">N/A</p>
        </section>

        <section>
            <h2>Shannon Entropy of Encrypted Text</h2>
            <p>Calculated Entropy: <span id="entropy">N/A</span></p>
        </section>
    </main>

    <footer>
        <p style="text-align: center; margin-top: 2rem;">&copy; 2024 Fabio Figara - Caesar Cipher Analysis</p>
    </footer>

    <script>
        const alphabet = "abcdefghijklmnopqrstuvwxyz";

        // Funzione per cifrare il testo usando il cifrario di Cesare
        function caesarCipher(text, shift) {
            let result = "";

            for (let char of text.toLowerCase()) {
                if (alphabet.includes(char)) {
                    let newIndex = (alphabet.indexOf(char) + shift) % alphabet.length;
                    result += alphabet[newIndex];
                } else {
                    result += char; // Mantiene i caratteri non alfabetici
                }
            }

            return result;
        }

        // Funzione per calcolare la frequenza delle lettere
        function calculateFrequency(text) {
            const counts = Array(26).fill(0);
            let totalLetters = 0;

            for (const char of text) {
                if (alphabet.includes(char)) {
                    counts[char.charCodeAt(0) - 97]++;
                    totalLetters++;
                }
            }

            return { counts, totalLetters };
        }

        // Funzione per cifrare il testo
        function encryptText() {
            const text = document.getElementById("inputText").value.toLowerCase();
            const shiftElement = document.getElementById("shiftValue");

            // Controlla se l'elemento esiste prima di continuare
            if (!shiftElement) {
                console.error("Elemento con ID 'shiftValue' non trovato!");
                return;
            }

            const shift = parseInt(shiftElement.value, 10);
            const encryptedTextElement = document.getElementById("cryptedText");

            const encryptedText = caesarCipher(text, shift);
            encryptedTextElement.textContent = encryptedText;

            // Aggiorna la distribuzione delle lettere
            const letterCounts = calculateFrequency(encryptedText);
            updateChart(letterCounts);

            // Calcola l'entropia di Shannon
            calculateEntropy(letterCounts);
        }

        let chartInstance = null;

        // Funzione per aggiornare il grafico della distribuzione delle lettere
        function updateChart(letterCounts) {
            const ctx = document.getElementById("letterDistributionChart").getContext("2d");
            const labels = alphabet.split("");

            if (chartInstance) {
                chartInstance.destroy();
            }

            chartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Letter Frequency',
                        data: letterCounts.counts,
                        backgroundColor: 'rgba(75, 192, 192, 0.5)',
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: { beginAtZero: true },
                        x: { title: { display: true, text: "Letters" } }
                    }
                }
            });
        }

        // Funzione per calcolare l'entropia di Shannon
        function calculateEntropy(letterCounts) {
            const total = letterCounts.counts.reduce((sum, count) => sum + count, 0);
            let entropy = 0;

            letterCounts.counts.forEach(count => {
                if (count > 0) {
                    const probability = count / total;
                    entropy -= probability * Math.log2(probability);
                }
            });

            document.getElementById("entropy").textContent = entropy.toFixed(4);
        }

        // Funzione per decriptare il testo usando la frequenza delle lettere
        function decryptText() {
            const encryptedText = document.getElementById("cryptedText").textContent;
            const { counts } = calculateFrequency(encryptedText);
            const mostFrequentIndex = counts.indexOf(Math.max(...counts));

            // Lettera più frequente (presumibilmente "e" nella lingua inglese)
            const commonLetter = 'e'; // "e" è la lettera più comune in inglese
            const shift = (mostFrequentIndex - alphabet.indexOf(commonLetter) + 26) % 26;

            const decryptedText = caesarCipher(encryptedText, 26 - shift);

            document.getElementById("decryptedText").textContent = decryptedText;
        }
    </script>
</body>
</html>
