<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Caesar Cipher & Frequency Analysis</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Stile CSS identico al precedente */
    </style>
</head>
<body>
    <header>
        <h1>Caesar Cipher, Shannon Entropy and Frequency Analysis</h1>
    </header>

    <main>
        <section>
            <h2>Encrypt Text with Caesar Cipher</h2>
            <label for="inputText">Enter Text:</label>
            <textarea id="inputText" rows="4" placeholder="Type your text here..."></textarea>

            <label for="shift">Shift Amount:</label>
            <input type="number" id="shift" value="3" min="1" max="25">

            <button onclick="encryptText()">Encrypt</button>

            <h3>Encrypted Text:</h3>
            <p id="encryptedText">N/A</p>
        </section>

        <section>
            <h2>Letter Frequency Distribution</h2>
            <canvas id="letterDistributionChart"></canvas>
        </section>

        <section>
            <h2>Frequency Analysis Decryption</h2>
            <button onclick="decryptText()">Attempt Decryption</button>
            <h3>Decrypted Text:</h3>
            <p id="decryptedText">N/A</p>
        </section>

        <section>
            <h2>Shannon Entropy of Encrypted Text</h2>
            <p>Calculated Entropy: <span id="entropy">N/A</span></p>
        </section>
    </main>

    <footer>
        <p style="text-align: center; margin-top: 2rem;">&copy; 2024 Fabio Figara - Caesar Cipher Analysis</p>
    </footer>

    <script>
        const alphabet = "abcdefghijklmnopqrstuvwxyz";

        function encryptText() {
            const text = document.getElementById("inputText").value.toLowerCase();
            const shift = parseInt(document.getElementById("shift").value, 10);
            const encryptedTextElement = document.getElementById("encryptedText");

            const encryptedText = caesarCipher(text, shift);
            encryptedTextElement.textContent = encryptedText;

            // Update frequency distribution
            const letterCounts = calculateFrequency(encryptedText);
            updateChart(letterCounts);

            // Calculate Shannon entropy
            calculateEntropy(letterCounts);
        }

        function caesarCipher(text, shift) {
            return text
                .split("")
                .map(char => {
                    if (alphabet.includes(char)) {
                        return alphabet[(alphabet.indexOf(char) + shift) % alphabet.length];
                    } else {
                        return char; // Preserve spaces and punctuation
                    }
                })
                .join("");
        }

        function calculateFrequency(text) {
            const counts = Array(26).fill(0);
            for (const char of text) {
                if (alphabet.includes(char)) {
                    counts[char.charCodeAt(0) - 97]++;
                }
            }
            return counts;
        }

        let chartInstance = null;

        function updateChart(letterCounts) {
            const ctx = document.getElementById("letterDistributionChart").getContext("2d");
            const labels = alphabet.split("");

            if (chartInstance) {
                chartInstance.destroy();
            }

            chartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Letter Frequency',
                        data: letterCounts,
                        backgroundColor: 'rgba(75, 192, 192, 0.5)',
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: { beginAtZero: true },
                        x: { title: { display: true, text: "Letters" } }
                    }
                }
            });
        }

        function decryptText() {
            const encryptedText = document.getElementById("encryptedText").textContent;
            const decryptedTextElement = document.getElementById("decryptedText");

            // Attempt decryption using frequency analysis
            const letterCounts = calculateFrequency(encryptedText);
            const mostFrequent = letterCounts.indexOf(Math.max(...letterCounts));

            const commonLetter = 'e'; // Most frequent letter in English
            const shift = (mostFrequent - alphabet.indexOf(commonLetter) + 26) % 26;

            const decryptedText = caesarCipher(encryptedText, 26 - shift);
            decryptedTextElement.textContent = decryptedText || "Decryption failed.";
        }

        function calculateEntropy(letterCounts) {
            const total = letterCounts.reduce((sum, count) => sum + count, 0);
            let entropy = 0;

            letterCounts.forEach(count => {
                if (count > 0) {
                    const probability = count / total;
                    entropy -= probability * Math.log2(probability);
                }
            });

            document.getElementById("entropy").textContent = entropy.toFixed(4);
        }
    </script>
</body>
</html>
