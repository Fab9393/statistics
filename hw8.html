<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Caesar Cipher & Frequency Analysis</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Reset base */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: Arial, sans-serif;
}

body {
    background-color: #f4f4f9;
    color: #333;
    line-height: 1.6;
    font-size: 16px;
}

header {
    background-color: #007bff;
    color: white;
    padding: 1rem;
    text-align: center;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

header h1 {
    font-size: 2.2rem;
    margin: 0;
}

main {
    width: 90%;
    max-width: 1200px;
    margin: 2rem auto;
    display: flex;
    flex-direction: column;
    gap: 2rem;
}

section {
    background-color: #fff;
    padding: 1.5rem;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

section h2 {
    font-size: 1.75rem;
    margin-bottom: 1rem;
    color: #333;
}

label {
    font-weight: bold;
    display: block;
    margin-top: 1rem;
    color: #555;
}

textarea, input, button {
    padding: 0.75rem;
    font-size: 1rem;
    border: 1px solid #ddd;
    border-radius: 5px;
    margin-top: 0.5rem;
    width: 100%;
}

textarea {
    resize: vertical;
}

button {
    background-color: #007bff;
    color: white;
    cursor: pointer;
    transition: background-color 0.3s;
    margin-top: 1rem;
}

button:hover {
    background-color: #0056b3;
}

button:active {
    background-color: #003f8b;
}

h3 {
    font-size: 1.2rem;
    margin-top: 1.5rem;
    color: #333;
}

p {
    font-size: 1rem;
    margin-top: 1rem;
    color: #555;
}

footer {
    background-color: #f1f1f1;
    padding: 1rem;
    text-align: center;
    color: #777;
    font-size: 0.9rem;
}

footer p {
    margin: 0;
}

#letterDistributionChart {
    margin-top: 2rem;
    width: 100%;
    height: 300px;
}

/* Responsività */
@media (max-width: 768px) {
    main {
        width: 100%;
        margin: 1rem;
    }

    section {
        padding: 1rem;
    }

    textarea {
        width: 100%;
    }
}

    </style>
</head>
<body>
    <header>
        <h1>Caesar Cipher, Shannon Entropy and Frequency Analysis</h1>
    </header>

    <main>
        <section>
            <h2>Encrypt Text with Caesar Cipher</h2>
            <label for="inputText">Enter Text:</label>
            <textarea id="inputText" rows="4" placeholder="Type your text here..."></textarea>

            <label for="shift">Shift Amount:</label>
            <input type="number" id="shift" value="3" min="1" max="25">

            <button onclick="encryptText()">Encrypt</button>

            <h3>Encrypted Text:</h3>
            <p id="encryptedText">N/A</p>
        </section>

        <section>
            <h2>Letter Frequency Distribution</h2>
            <canvas id="letterDistributionChart"></canvas>
        </section>

        <section>
            <h2>Frequency Analysis Decryption</h2>
            <button onclick="decryptText()">Attempt Decryption</button>
            <h3>Decrypted Text:</h3>
            <p id="decryptedText">N/A</p>
        </section>

        <section>
            <h2>Shannon Entropy of Encrypted Text</h2>
            <p>Calculated Entropy: <span id="entropy">N/A</span></p>
        </section>
    </main>

    <footer>
        <p style="text-align: center; margin-top: 2rem;">&copy; 2024 Fabio Figara - Caesar Cipher Analysis</p>
    </footer>

    <script>
const alphabet = "abcdefghijklmnopqrstuvwxyz";

function encryptText() {
    const text = document.getElementById("inputText").value.toLowerCase();
    const shift = parseInt(document.getElementById("shift").value, 10);
    const encryptedTextElement = document.getElementById("encryptedText");

    const encryptedText = caesarCipher(text, shift);
    encryptedTextElement.textContent = encryptedText;

    // Update frequency distribution
    const letterCounts = calculateFrequency(encryptedText);
    updateChart(letterCounts);

    // Calculate Shannon entropy
    calculateEntropy(letterCounts);
}

function caesarCipher(text, shift) {
    return text
        .split("")
        .map(char => {
            if (alphabet.includes(char)) {
                return alphabet[(alphabet.indexOf(char) + shift) % alphabet.length];
            } else {
                return char; // Preserve spaces and punctuation
            }
        })
        .join("");
}

function calculateFrequency(text) {
    const counts = Array(26).fill(0);
    let totalLetters = 0;
    
    for (const char of text) {
        if (alphabet.includes(char)) {
            counts[char.charCodeAt(0) - 97]++;
            totalLetters++;
        }
    }
    
    return { counts, totalLetters };
}

let chartInstance = null;

function updateChart(letterCounts) {
    const ctx = document.getElementById("letterDistributionChart").getContext("2d");
    const labels = alphabet.split("");

    if (chartInstance) {
        chartInstance.destroy();
    }

    chartInstance = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                label: 'Letter Frequency',
                data: letterCounts,
                backgroundColor: 'rgba(75, 192, 192, 0.5)',
                borderColor: 'rgba(75, 192, 192, 1)',
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: { beginAtZero: true },
                x: { title: { display: true, text: "Letters" } }
            }
        }
    });
}

function calculateEntropy(letterCounts) {
    const total = letterCounts.reduce((sum, count) => sum + count, 0);
    let entropy = 0;

    letterCounts.forEach(count => {
        if (count > 0) {
            const probability = count / total;
            entropy -= probability * Math.log2(probability);
        }
    });

    document.getElementById("entropy").textContent = entropy.toFixed(4);
}

function decryptText() {
    const encryptedText = document.getElementById("encryptedText").textContent;
    const decryptedTextElement = document.getElementById("decryptedText");

    // Attempt decryption using frequency analysis
    const { counts, totalLetters } = calculateFrequency(encryptedText);
    const mostFrequent = counts.indexOf(Math.max(...counts));

    const commonLetter = 'e'; // Most frequent letter in English
    const shift = (mostFrequent - alphabet.indexOf(commonLetter) + 26) % 26;

    const decryptedText = caesarCipher(encryptedText, 26 - shift);
    decryptedTextElement.textContent = decryptedText || "Decryption failed.";
}

function decrypt(cypherText) {
    const languageFrequency = "eaionlrtscdpumvghfbqz"; // Frequenza in italiano o inglese
    const topN = 4; // Analizza le prime N lettere più frequenti

    // Calcola la distribuzione di frequenza delle lettere nel testo cifrato
    const letterCounts = calculateFrequency(cypherText);

    // Ordina le lettere in base alla frequenza
    const sortedLetters = Object.keys(letterCounts).sort((a, b) => letterCounts[b] - letterCounts[a]);

    // Prendi le prime N lettere più frequenti nel testo cifrato
    const mostFrequentInCypher = sortedLetters.slice(0, topN);

    // Prendi le prime N lettere più frequenti nella lingua
    const mostFrequentInLanguage = languageFrequency.slice(0, topN).split("");

    var arrShift = [];
    for (let i = 0; i < topN; i++) {
        for (let j = 0; j < topN; j++) {
            const shift = (mostFrequentInCypher[i].charCodeAt(0) - mostFrequentInLanguage[j].charCodeAt(0) + 26) % 26;
            arrShift.push(shift);
        }
    }

    // Trova il shift più comune (la moda degli shift)
    const bestShift = calcolaModa(arrShift);

    // Usa lo shift calcolato per decriptare il testo
    const decryptedText = caesarCipher(cypherText, 26 - bestShift); // Decrypt usando lo shift trovato
    return decryptedText;
}

function calcolaModa(arr) {
    const frequenze = {};
    let moda = [];
    let maxFreq = 0;

    // Conta la frequenza di ogni elemento
    for (let num of arr) {
        frequenze[num] = (frequenze[num] || 0) + 1;
    }

    // Trova la frequenza massima
    for (let num in frequenze) {
        if (frequenze[num] > maxFreq) {
            maxFreq = frequenze[num];
            moda = [num]; // Resetta la moda
        } else if (frequenze[num] === maxFreq) {
            moda.push(num); // Aggiungi alla moda in caso di pareggio
        }
    }

    return parseInt(moda[0], 10); // Restituisce il shift più comune
}

    </script>
</body>
</html>
