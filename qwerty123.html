<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagramma Interattivo Moderno</title>
    <style>
        body {
            margin: 0;
            font-family: 'Arial', sans-serif;
            display: flex;
            height: 100vh;
            background-color: #f0f0f0;
        }
        /* Stili per la sidebar */
        .sidebar {
            width: 200px;
            background-color: #34495e;
            color: #ecf0f1;
            padding: 20px;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }
        .sidebar img, .sidebar button {
            width: 100px;
            margin: 10px 0;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .sidebar img:hover, .sidebar button:hover {
            transform: scale(1.1);
        }
        button {
            background-color: #2980b9;
            border: none;
            padding: 10px;
            border-radius: 5px;
            color: #ecf0f1;
            cursor: pointer;
            width: 100%;
        }
        button:hover {
            background-color: #3498db;
        }
        /* Area di editing */
        .editing-area {
            flex: 1;
            position: relative;
            background-color: #ecf0f1;
            overflow: hidden;
        }
        /* Stili per i dispositivi */
        .device {
            position: absolute;
            width: 70px;
            height: 70px;
            cursor: move;
            text-align: center;
            transition: transform 0.2s;
        }
        .device:hover {
            transform: scale(1.05);
        }
        .connector-point {
            width: 12px;
            height: 12px;
            background-color: #3498db;
            position: absolute;
            border-radius: 50%;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .connector-point:hover {
            background-color: #2980b9;
        }
        .top { top: -6px; left: 50%; transform: translateX(-50%); }
        .right { top: 50%; right: -6px; transform: translateY(-50%); }
        .bottom { bottom: -6px; left: 50%; transform: translateX(-50%); }
        .left { top: 50%; left: -6px; transform: translateY(-50%); }
        /* Linee di collegamento */
        .line {
            position: absolute;
            background-color: #2c3e50;
            pointer-events: none;
            transition: background-color 0.2s;
        }
        /* Etichette */
        .label {
            position: absolute;
            font-size: 16px;
            font-weight: bold;
            color: #2980b9;
            cursor: move;
            background-color: #ecf0f1;
            border: 1px solid #3498db;
            border-radius: 5px;
            padding: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <h3>Menu</h3>
        <img id="addDevice" src="device-removebg-preview.png" alt="Aggiungi dispositivo">
        <button id="addLink">Collegamento</button>
        <button id="addLabel">Etichetta</button>
    </div>

    <div id="editingArea" class="editing-area"></div>

    <script>
        let editingArea = document.getElementById('editingArea');
        let addDeviceButton = document.getElementById('addDevice');
        let addLinkButton = document.getElementById('addLink');
        let addLabelButton = document.getElementById('addLabel');
        let linkMode = false;
        let labelMode = false;
        let selectedDevice = null;
        let selectedPoint = null;

        // Funzione per aggiungere un dispositivo
        addDeviceButton.addEventListener('click', () => {
            let device = document.createElement('div');
            device.classList.add('device');
            device.style.left = '100px';
            device.style.top = '100px';
            device.innerHTML = `
                <img src="device-removebg-preview.png" width="100%">
                <div class="connector-point top" data-position="top"></div>
                <div class="connector-point right" data-position="right"></div>
                <div class="connector-point bottom" data-position="bottom"></div>
                <div class="connector-point left" data-position="left"></div>
            `;
            makeDraggable(device);
            editingArea.appendChild(device);
        });

        // Modalità collegamento
        addLinkButton.addEventListener('click', () => {
            linkMode = !linkMode;
            addLinkButton.style.backgroundColor = linkMode ? '#2980b9' : '#3498db';
        });

        // Modalità etichetta
        addLabelButton.addEventListener('click', () => {
            labelMode = !labelMode;
            addLabelButton.style.backgroundColor = labelMode ? '#2980b9' : '#3498db';
        });

        // Funzione per rendere un elemento trascinabile
        function makeDraggable(element) {
            let offsetX, offsetY;
            element.onmousedown = (e) => {
                offsetX = e.clientX - element.offsetLeft;
                offsetY = e.clientY - element.offsetTop;
                document.onmousemove = (e) => {
                    element.style.left = `${e.clientX - offsetX}px`;
                    element.style.top = `${e.clientY - offsetY}px`;
                    updateLines();
                };
                document.onmouseup = () => {
                    document.onmousemove = null;
                    document.onmouseup = null;
                };
            };

            element.querySelectorAll('.connector-point').forEach(point => {
                point.addEventListener('click', (e) => {
                    e.stopPropagation(); // Impedisce il click di propagarsi al documento
                    if (!linkMode) return;

                    if (!selectedDevice) {
                        selectedDevice = element;
                        selectedPoint = point;
                        point.style.backgroundColor = '#e74c3c'; // Rosso per il punto selezionato
                    } else {
                        drawLink(selectedDevice, selectedPoint, element, point);
                        selectedPoint.style.backgroundColor = '#3498db'; // Ripristina il colore originale
                        selectedDevice = null;
                        selectedPoint = null;
                    }
                });
            });
        }

        // Funzione per disegnare una linea tra due punti di connessione
        function drawLink(device1, point1, device2, point2) {
            let line = document.createElement('div');
            line.classList.add('line');
            editingArea.appendChild(line);
            updateLine(line, point1, point2);
            line.dataset.device1 = `${device1.style.left},${device1.style.top},${point1.dataset.position}`;
            line.dataset.device2 = `${device2.style.left},${device2.style.top},${point2.dataset.position}`;
        }

        // Funzione per calcolare la posizione e l'angolo della linea tra i punti
        function updateLine(line, point1, point2) {
            let rect1 = point1.getBoundingClientRect();
            let rect2 = point2.getBoundingClientRect();
            let x1 = rect1.left + rect1.width / 2 - editingArea.getBoundingClientRect().left;
            let y1 = rect1.top + rect1.height / 2 - editingArea.getBoundingClientRect().top;
            let x2 = rect2.left + rect2.width / 2 - editingArea.getBoundingClientRect().left;
            let y2 = rect2.top + rect2.height / 2 - editingArea.getBoundingClientRect().top;
            let length = Math.sqrt((x2 - x1)**2 + (y2 - y1)**2);
            let angle = Math.atan2(y2 - y1, x2 - x1) * 180 / Math.PI;

            line.style.width = `${length}px`;
            line.style.left = `${x1}px`;
            line.style.top = `${y1}px`;
            line.style.transform = `rotate(${angle}deg)`;
        }

        // Funzione per aggiornare tutte le linee quando i dispositivi si spostano
        function updateLines() {
            document.querySelectorAll('.line').forEach(line => {
                let [x1, y1, position1] = line.dataset.device1.split(',').map(Number);
                let [x2, y2, position2] = line.dataset.device2.split(',').map(Number);
                let point1 = document.querySelector(`.connector-point[data-position="${position1}"]`);
                let point2 = document.querySelector(`.connector-point[data-position="${position2}"]`);
                if (point1 && point2) {
                    updateLine(line, point1, point2);
                }
            });
        }
    </script>
</body>
</html>
