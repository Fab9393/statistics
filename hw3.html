<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulazione di Attacco Continua</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        #controls {
            margin-bottom: 20px;
        }
        #chartContainer {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
            margin-bottom: 20px;
        }
        canvas {
            max-width: 45%;
        }
        .container {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h2>HW3 - Simulazione di Attacco Continua</h2>
    <div id="controls">
        <label for="lambda">Tasso di Attacco (λ):</label>
        <input type="number" id="lambda" step="0.01" value="0.8" min="0"><br><br>
        <label for="time">Tempo (T):</label>
        <input type="number" id="time" value="10" min="1"><br><br>
        <label for="intervals">Numero di Intervalli (n):</label>
        <input type="number" id="intervals" value="1000" min="1"><br><br>
        <button id="simulateButton">Esegui Simulazione</button>
    </div>
    <div id="chartContainer">
        <div id ="canvasContainer">
            <canvas id="attackChart"></canvas>
        </div>
        <div id ="canvasContainer">
            <canvas id="histogramChart"></canvas>
        </div>
    </div>
    <div class="container">
        <h3>Risultati</h3>
        <p>Media: <span id="mean">0</span></p>
        <p>Deviazione Standard: <span id="stdDev">0</span></p>
        <p>Moda: <span id="mode">0</span></p>
    </div>
    <script>
        document.getElementById('simulateButton').addEventListener('click', () => {
            const lambda = parseFloat(document.getElementById('lambda').value);
            const T = parseInt(document.getElementById('time').value);
            const n = parseInt(document.getElementById('intervals').value);

            const { time, attacks } = simulateContinuousAttacks(lambda, T, n);
            renderChart(time, attacks, 'attackChart');
            renderHistogram(attacks, 'histogramChart');

            const results = calculateStatistics(attacks);
            displayResults(results);
        });

        // Simulazione degli attacchi continui
        function simulateContinuousAttacks(lambda, T, n) {
            const dt = T / n; // Delta t: intervallo di tempo
            const time = Array.from({ length: n }, (_, i) => i * dt);
            const attacks = new Array(n).fill(0); // Attacchi inizializzati a zero

            for (let i = 1; i < n; i++) {
                // Probabilità di un attacco: lambda * dt
                if (Math.random() < lambda * dt) {
                    attacks[i] = 1; // Un attacco si è verificato
                }
            }

            return { time, attacks };
        }

        // Grafico cumulativo degli attacchi
        function renderChart(time, attacks, chartID) {
            const cumulativeAttacks = attacks.reduce((acc, curr, idx) => {
                acc.push((acc[idx - 1] || 0) + curr);
                return acc;
            }, []);

            const ctx = document.getElementById(chartID).getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: time,
                    datasets: [{
                        label: 'Attacchi Cumulativi',
                        data: cumulativeAttacks,
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 1,
                        fill: false
                    }]
                },
                options: {
                    scales: {
                        x: { beginAtZero: true },
                        y: { beginAtZero: true }
                    }
                }
            });
        }

        // Istogramma degli attacchi
        function renderHistogram(attacks, chartID) {
            const ctx = document.getElementById(chartID).getContext('2d');

            // Calcolo del numero di attacchi
            const attackCounts = attacks.reduce((acc, attack) => {
                acc[attack] = (acc[attack] || 0) + 1;
                return acc;
            }, {});

            const labels = Object.keys(attackCounts);
            const data = Object.values(attackCounts);

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Conteggio Attacchi',
                        data: data,
                        backgroundColor: 'rgba(153, 102, 255, 0.6)',
                        borderColor: 'rgba(153, 102, 255, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    indexAxis: 'y', // Istogramma orizzontale
                    scales: {
                        x: { beginAtZero: true },
                        y: { beginAtZero: true }
                    }
                }
            });
        }

        // Calcolo delle statistiche
        function calculateStatistics(data) {
            const mean = data.reduce((sum, val) => sum + val, 0) / data.length;
            const variance = data.reduce((sum, val) => sum + Math.pow(val - mean, 2), 0) / data.length;
            const stdDev = Math.sqrt(variance);

            // Calcolo della moda
            const mode = data.filter(val => val === 1).length > 0 ? 1 : 0;

            return { mean, stdDev, mode };
        }

        // Visualizzazione dei risultati
        function displayResults({ mean, stdDev, mode }) {
            document.getElementById('mean').textContent = mean.toFixed(2);
            document.getElementById('stdDev').textContent = stdDev.toFixed(2);
            document.getElementById('mode').textContent = mode;
        }

    </script>
</body>
</html>
