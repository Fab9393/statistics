<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulation</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Inter', 'Helvetica Neue', Arial, sans-serif;
            background-color: #f0f4f8;
            margin: 0;
        }

        .container {
            display: flex;
            justify-content: center;
            padding: 40px;
        }

        .hw {
            min-height: 100vh;
            display: flex;
            align-items: flex-start;
            flex-direction: column;
            width: 80%;
            max-width: 1200px;
            background-color: #ffffff;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            border-radius: 16px;
            padding: 60px;
        }

        h1 {
            font-size: 3.5em;
            color: #2c3e50;
        }

        h2, h3 {
            color: #34495e;
        }

        .input-group {
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
        }

        label {
            font-size: 1.1em;
        }

        input[type='number'], select {
            width: 120px;
            padding: 12px;
            border: 2px solid #dde4e9;
            border-radius: 8px;
        }

        .run-button {
            background-color: #3498db;
            color: #fff;
            padding: 14px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1em;
        }

        .charts-container {
            display: flex;
            margin-top: 50px;
            height: 600px;
        }

        canvas {
            flex: 1;
            margin-left: 8px;
        }

    </style>
</head>
<body>
    <div class="container">
        <div class="hw">
            <h1>Homework #2</h1>
            <h2>Theory: Welford's Algorithm</h2>
            <p>Welford's algorithm provides an efficient and numerically stable method to compute mean and variance in a single pass:</p>
            <pre><code>
            // For mean:
            M₁ = x₁
            for k = 2 to n:
                M_k = M_{k-1} + (x_k - M_{k-1}) / k

            // For variance:
            S₁ = 0
            for k = 2 to n:
                S_k = S_{k-1} + (x_k - M_{k-1})(x_k - M_k)
            variance = S_n / (n - 1)
            </code></pre>
            <h3>Why Use Welford's Algorithm?</h3>
            <p>1. Minimizes rounding errors.</p>
            <p>2. Computes mean and variance in a single pass.</p>
            <p>3. Suitable for streaming or real-time applications.</p>
            <h2>Application / Practice</h2>
            <p>We have n servers with m attackers. The hacker has probability p to penetrate each server.</p>
            <h2>Input Parameters</h2>
            <div class="input-group">
                <label for="n">Number of servers (n):</label>
                <input type="number" id="n" min="1" value="25">
            </div>
            <div class="input-group">
                <label for="m">Number of attackers (m):</label>
                <input type="number" id="m" min="1" value="50">
            </div>
            <div class="input-group">
                <label for="p">Probability of penetration (p):</label>
                <input type="number" id="p" min="0" max="1" step="0.01" value="0.5">
            </div>
            <div class="input-group">
                <label for="midPointIndex">Mid-point Index:</label>
                <input type="number" id="midPointIndex" min="0" value="12">
            </div>
            <div class="input-group">
                <label for="simulationType">Simulation Type:</label>
                <select id="simulationType">
                    <option value="randomWalk">Random Walk</option>
                    <option value="bernoulli">Bernoulli</option>
                </select>
            </div>
            <div class="input-group">
                <label for="frequencyType">Frequency Type:</label>
                <select id="frequencyType">
                    <option value="absolute">Absolute</option>
                    <option value="relative">Relative</option>
                </select>
            </div>
            <div class="run-button-container">
                <button class="run-button" id="runSimulationButton">Run Simulation</button>
            </div>
            <div class="statistics">
                <div>
                    <h3>Midpoint Statistics</h3>
                    <p id="midPointMean">Mean: 0</p>
                    <p id="midPointStdDev">Standard Deviation: 0</p>
                    <p id="midPointMode">Mode: 0</p>
                </div>
                <div>
                    <h3>Final Timestep Statistics</h3>
                    <p id="mean">Mean: 0</p>
                    <p id="stdDev">Standard Deviation: 0</p>
                    <p id="mode">Mode: 0</p>
                </div>
            </div>
            <div class="charts-container">
                <canvas id="timestepsChart"></canvas>
                <canvas id="histogramChart"></canvas>
            </div>
        </div>
    </div>

    <script>
        const runSimulationButton = document.getElementById('runSimulationButton');
        const nInput = document.getElementById('n');
        const mInput = document.getElementById('m');
        const pInput = document.getElementById('p');
        const midPointIndexInput = document.getElementById('midPointIndex');
        const simulationTypeInput = document.getElementById('simulationType');
        const frequencyTypeInput = document.getElementById('frequencyType');

        const midPointMeanElement = document.getElementById('midPointMean');
        const midPointStdDevElement = document.getElementById('midPointStdDev');
        const midPointModeElement = document.getElementById('midPointMode');
        const meanElement = document.getElementById('mean');
        const stdDevElement = document.getElementById('stdDev');
        const modeElement = document.getElementById('mode');

        const timestepsChartContext = document.getElementById('timestepsChart').getContext('2d');
        const histogramChartContext = document.getElementById('histogramChart').getContext('2d');

        let timesteps = [];
        let chartInstance = null;
        let histogramChartInstance = null;

        runSimulationButton.addEventListener('click', runSimulation);

        function runSimulation() {
            const n = parseInt(nInput.value);
            const m = parseInt(mInput.value);
            const p = parseFloat(pInput.value);
            const midPointIndex = parseInt(midPointIndexInput.value);
            const simulationType = simulationTypeInput.value;
            const frequencyType = frequencyTypeInput.value;

            // Initialize timesteps
            timesteps = [Array(m).fill(0)];
            for (let i = 1; i <= n; i++) {
                timesteps.push(timesteps[i - 1].map((value) => {
                    return simulationType === 'randomWalk' ? (Math.random() < p ? value + 1 : value - 1) : (Math.random() < p ? value + 1 : value);
                }));
            }

            // Normalize to relative frequency if needed
            if (frequencyType === 'relative') {
                timesteps = timesteps.map((step) => step.map((value) => value / n));
            }

            plotTimesteps(midPointIndex);
            plotHistogram(n);

            const finalTimestep = timesteps[n];
            const midPointData = timesteps[midPointIndex];
            const mean = computeMean(finalTimestep);
            const stdDev = computeStandardDeviation(finalTimestep);
            const mode = computeMode(finalTimestep);
            const midPointMean = computeMean(midPointData);
            const midPointStdDev = computeStandardDeviation(midPointData);
            const midPointMode = computeMode(midPointData);

            // Update statistics
            midPointMeanElement.innerText = `Mean: ${midPointMean.toFixed(2)}`;
            midPointStdDevElement.innerText = `Standard Deviation: ${midPointStdDev.toFixed(2)}`;
            midPointModeElement.innerText = `Mode: ${midPointMode.join(', ')}`;
            meanElement.innerText = `Mean: ${mean.toFixed(2)}`;
            stdDevElement.innerText = `Standard Deviation: ${stdDev.toFixed(2)}`;
            modeElement.innerText = `Mode: ${mode.join(', ')}`;
        }

        function plotTimesteps(midPointIndex) {
            const data = timesteps.map((step, index) => {
                return {
                    x: index,
                    y: step[midPointIndex],
                };
            });

            if (chartInstance) {
                chartInstance.destroy();
            }

            chartInstance = new Chart(timestepsChartContext, {
                type: 'line',
                data: {
                    datasets: [{
                        label: 'Timestep Data',
                        data: data,
                        borderColor: 'rgba(52, 152, 219, 1)',
                        fill: false,
                        tension: 0.1,
                    }]
                },
                options: {
                    scales: {
                        x: { type: 'linear', title: { display: true, text: 'Timestep' } },
                        y: { title: { display: true, text: 'Value' } },
                    }
                }
            });
        }

        function plotHistogram(n) {
            const finalTimestep = timesteps[n];
            const histogramData = {};

            finalTimestep.forEach(value => {
                histogramData[value] = (histogramData[value] || 0) + 1;
            });

            const labels = Object.keys(histogramData);
            const values = Object.values(histogramData);

            if (histogramChartInstance) {
                histogramChartInstance.destroy();
            }

            histogramChartInstance = new Chart(histogramChartContext, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Frequency',
                        data: values,
                        backgroundColor: 'rgba(52, 152, 219, 0.6)',
                    }]
                },
                options: {
                    scales: {
                        x: { title: { display: true, text: 'Value' } },
                        y: { title: { display: true, text: 'Frequency' } },
                    }
                }
            });
        }

        function computeMean(data) {
            const total = data.reduce((sum, value) => sum + value, 0);
            return total / data.length;
        }

        function computeStandardDeviation(data) {
            const mean = computeMean(data);
            const squaredDiffs = data.map(value => Math.pow(value - mean, 2));
            return Math.sqrt(computeMean(squaredDiffs));
        }

        function computeMode(data) {
            const frequency = {};
            data.forEach(value => {
                frequency[value] = (frequency[value] || 0) + 1;
            });

            const maxFrequency = Math.max(...Object.values(frequency));
            return Object.keys(frequency).filter(value => frequency[value] === maxFrequency);
        }

    </script>
</body>
</html>

